{{#to_json format="yaml"}}
---
metadata:
  annotations:
    mayfly.cloud.namecheap.com/expire: 120h
  labels: {{json_to_str (selector_from_ctx this comp="backup")}}
spec:
  containers:
  - name: backup
    image: {{agent_image}}
    imagePullPolicy: IfNotPresent
    args:
    - {{instance.package.type}}
    - backup
    env: {{json_to_str envs}}
    envFrom: {{json_to_str envs_from}}
    volumeMounts: {{json_to_str mounts}}
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 50m
        memory: 64Mi
    securityContext:
      runAsUser: 0
      runAsGroup: 0
      privileged: false
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
        add:
        - CHOWN
        - FOWNER
        - DAC_OVERRIDE
        - DAC_READ_SEARCH
  volumes: {{json_to_str volumes}}
  serviceAccountName: {{service_account}}
  restartPolicy: Never
  priorityClassName: vynil-backup
  securityContext:
    runAsGroup: 0
    runAsUser: 0
    runAsNonRoot: false
{{/to_json}}
